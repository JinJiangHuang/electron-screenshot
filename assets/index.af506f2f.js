import{r as e,a as t,d as n,t as o,c as a,w as s,b as i,e as r,f as l,g as c,p as u,h as d,o as m,i as h,j as p,k as v,F as f,l as b,m as x,n as y,q as w,s as E,u as _,v as g,x as M,y as R}from"./vendor.1e27083b.js";let L;!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const o=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,s)=>{const i=new URL(e,o);if(self[t].moduleMap[i])return n(self[t].moduleMap[i]);const r=new Blob([`import * as m from '${i}';`,`${t}.moduleMap['${i}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){s(new Error(`Failed to import: ${e}`)),a(l)},onload(){n(self[t].moduleMap[i]),a(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("assets/");const k={},C=new Image,O=e(!1),T=t({x:{min:0,max:0},y:{min:0,max:0}}),I=t({x:0,y:0,h:0,w:0}),P=e(null),S=e(null),A=[];function z(e){let t=!1;return function(...n){t||(t=!0,window.requestAnimationFrame((()=>{e.apply(this,n),t=!1})))}}const j=10,B=10,[N,U]=[120,88],[D,$]=[N/4,U/4];var W=n({props:{mousePoint:{type:Object,required:!0},canvas:{type:Object,required:!0}},setup(t){const{mousePoint:n,canvas:i}=o(t),r=e(null),l=a((()=>{const e={};if(n.value){const[t,o]=n.value,[a,s]=[j+120,B+120],i=t+a>T.x.max?t-a:t+j,r=o+s>T.y.max?o-s:o+B;e.left=`${i}px`,e.top=`${r}px`}return e}));return s(n,z((e=>{if(!e||!i.value||!r.value)return;const[t,n]=e,o=r.value.getContext("2d");o.clearRect(0,0,N,U),o.drawImage(i.value,t-D/2,n-$/2,D,$,0,0,N,U)}))),document.body.style,{canvasRef:r,DW:N,DH:U,style:l}}});const V=c("data-v-123d3f4b");u("data-v-123d3f4b");const F={class:"capture-info__view"},H=r("svg",{viewBox:"0 0 120 88",xmlns:"http://www.w3.org/2000/svg",fill:"none"},[r("path",{d:"M 0 1 H 119 V87 H1 V1",stroke:"red","stroke-width":"2"}),r("path",{d:"M 0 44 H 119",stroke:"red","stroke-width":"2"}),r("path",{d:"M 60 0 V 88",stroke:"red","stroke-width":"2"})],-1),q={class:"capture-info__p"};d();const Z=V(((e,t)=>(m(),i("div",{class:"capture-info__wrap",style:e.style},[r("div",F,[r("canvas",{ref:"canvasRef",width:e.DW,height:e.DH},null,8,["width","height"]),H]),r("div",q,[l(e.$slots,"default")])],4))));W.render=Z,W.__scopeId="data-v-123d3f4b";const G=Math.PI/6;const X=e=>new Promise(((t,n)=>e.toBlob((e=>e?t(e):n(new Error("Failed to convert file"))))));function J(e,t,n,o,a){const s=document.createElement("canvas");Object.assign(s,{height:a,width:o});return s.getContext("2d").drawImage(e,t,n,o,a,0,0,o,a),s}function K(e,t,n){t.clearRect(0,0,T.x.max,T.y.max),t.drawImage(n,0,0),e.forEach((e=>{switch(e.id){case"LINE":{const[n,o]=e.path;!function(e,t,n,o,a){e.lineWidth=o,e.strokeStyle=a,e.lineCap="round",e.beginPath(),e.moveTo(...t),e.lineTo(...n),e.stroke()}(t,n,o,1,"red");break}case"RECT":{const[n,o]=e.path;!function(e,t,n,o,a){const[[s,i],[r,l]]=[t,n],c=[t,[s,l],n,[r,i]];e.beginPath(),e.moveTo(...t),c.slice(1).forEach((t=>e.lineTo(...t))),e.closePath(),e.lineWidth=o,e.strokeStyle=a,e.stroke()}(t,n,o,1,"red");break}case"ARROW":{const[n,o]=e.path;!function(e,t,n,o,a){const[s,i]=t,[r,l]=n,c=Math.atan((i-i)/(s-r)),u=Math.abs((r-s)/(Math.cos(c)*Math.cos(G))),d=Math.min(u,10+5*o),m=r<s?-1:1,[h,p]=[r-Math.cos(c-G)*d*m,l-Math.sin(c-G)*d*m],[v,f]=[r-Math.cos(c+G)*d*m,l-Math.sin(c+G)*d*m],[b,x]=[(v-h)/3,(f-p)/3],[y,w]=[h+b,p+x],[E,_]=[h-b,p-x],g=[[s,i],[y,w],[h,p],[r,l],[v,f],[E,_]];e.beginPath(),e.moveTo(s,i),g.slice(1).forEach((t=>e.lineTo(...t))),e.closePath(),e.fillStyle=a,e.fill()}(t,n,o,4,"red");break}case"ELLIPSE":{const[n,o]=e.path;!function(e,t,n,o,a){const[[s,i],[r,l]]=[t,n],[c,u]=[s-r,i-l].map((e=>Math.abs(e/2))),[d,m]=[(s+r)/2,(i+l)/2],h=Math.max(c,u),[p,v]=[c/h,u/h];e.save(),e.scale(p,v),e.beginPath(),e.arc(d/p,m/v,h,0,2*Math.PI),e.closePath(),e.restore(),e.lineWidth=o,e.strokeStyle=a,e.stroke()}(t,n,o,1,"red");break}}}))}const Q=function(e){for(const t of e){const e=t.target.__resizeListeners__||[];e.length&&e.forEach((e=>{e()}))}},Y=function(e,t){e&&(e.__resizeListeners__||(e.__resizeListeners__=[],e.__ro__=new h(Q),e.__ro__.observe(e)),e.__resizeListeners__.push(t))},ee=function(e,t){e&&e.__resizeListeners__&&(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),e.__resizeListeners__.length||e.__ro__.disconnect())};let te=null;function ne(e=document.getElementsByTagName("head")[0]){let t=document.createElement("style");return t.media="screen",e.appendChild(t),t}function oe(e,t,n=function(){return null!=te?te:te=ne()}()){n&&t&&n.sheet.insertRule(e+"{"+t+"}",0)}const ae=0,se=6,ie=[{icon:"A",label:"添加文字",id:"TEXT"},{icon:"⬜",label:"矩形工具",id:"RECT"},{icon:"⚪",label:"椭圆工具",id:"ELLIPSE"},{icon:"╱",label:"直线工具",id:"LINE"},{icon:"↗",label:"箭头工具",id:"ARROW"},{icon:"🖊",label:"笔刷工具",id:"BRUSH"}],re=[{icon:"↩",label:"撤销",id:"RETURN"},{icon:"⬇",label:"保存(下载图片)",id:"SAVE"},{icon:"❌",label:"取消",id:"CANCEL"},{icon:"✔",label:"确定(复制到剪切板)",id:"CONFIRM"}];var le=n({name:"ToolBox",setup(){const n=e(null),o=t({w:0,h:0}),s=a((()=>{const e={};if(O.value&&"CREATE"!==P.value){const{x:t,y:n,w:a,h:s}=I,i=n+s+se+o.h+se>T.y.max?Math.max(n-o.h-se,T.y.min):n+s+se,r=Math.max(t+a-o.w-ae,T.x.min+ae);e.left=`${r}px`,e.top=`${i}px`}else e.visibility="hidden";return e})),i=z((function(){const{width:e,height:t}=n.value.getBoundingClientRect();Object.assign(o,{w:e,h:t})}));return p((()=>{Y(n.value,i)})),v((()=>{ee(n.value,i)})),{TOOL_ACTIONS:ie,OPT_ACTIONS:re,style:s,action:P,handleExecCmd:function(e){switch(e){case"SAVE":{const{x:e,y:t,w:n,h:o}=I;!function(e,t,n,o,a){const s=J(e,t,n,o,a),i=s.toDataURL("image/png");X(s).then(console.log);const r=document.createElement("a");r.download=`导出图片${Date.now()}.png`,r.href=i,r.click()}(S.value,e,t,n,o);break}case"CONFIRM":{const{x:e,y:n,w:o,h:a}=I;(t=J(S.value,e,n,o,a),navigator.permissions.query({name:"clipboard-write"}).then((async({state:e})=>{if("granted"!==e)throw new Error("clipboard-permissoin not granted");return X(t).then((e=>{const{type:t}=e;return navigator.clipboard.write([new ClipboardItem({[t]:e})])}))}))).then(console.log,console.warn);break}case"RETURN":if(0===A.length)break;A.pop(),K(A,S.value.getContext("2d"),C);break;default:console.log("TODO EXEC CMD => ",e)}var t},handleUpdateTool:function(e){P.value=P.value===e?null:e},toolBoxRef:n}}});const ce=r("div",{class:"tool-divider"},null,-1);le.render=function(e,t){return m(),i("div",{class:"tool-box",ref:"toolBoxRef",style:e.style},[(m(!0),i(f,null,b(e.TOOL_ACTIONS,(t=>(m(),i("button",{class:["tool-item",e.action===t.id&&"active"],key:t.id,title:t.label,onClick:n=>e.handleUpdateTool(t.id)},x(t.icon),11,["title","onClick"])))),128)),ce,(m(!0),i(f,null,b(e.OPT_ACTIONS,(t=>(m(),i("button",{class:"tool-item",key:t.id,title:t.label,onClick:n=>e.handleExecCmd(t.id)},x(t.icon),9,["title","onClick"])))),128))],4)};const ue=[{position:["top"],cursor:"ns-resize"},{position:["bottom"],cursor:"ns-resize"},{position:["left"],cursor:"ew-resize"},{position:["right"],cursor:"ew-resize"},{position:["top","left"],cursor:"nwse-resize"},{position:["bottom","right"],cursor:"nwse-resize"},{position:["top","right"],cursor:"nesw-resize"},{position:["bottom","left"],cursor:"nesw-resize"}];var de=n({name:"App",components:{InfoBox:W,ToolBox:le},setup(t){const n=e(null);let o=null;const i=e(null),r=e("0, 0, 0");let l=y.cloneDeep(I),c=[],u=null;const d=a((()=>P.value&&["CREATE","RESIZE"].includes(P.value))),m=a((()=>{const{x:e,y:t,h:n,w:o}=I,[a,s,i,r]=[e,t,n,o].map((e=>`${e}px`)),l={left:a,top:s,height:i,width:r,cursor:""};return P.value||(l.cursor="move"),l})),h=a((()=>{var e;return null==(e=S.value)?void 0:e.getContext("2d")}));s(i,z((e=>{if(!h.value||!e)return;const{data:t}=h.value.getImageData(e[0],e[1],1,1);r.value=t.slice(0,3).join(", ")})));const f=z((async function(){const{clientHeight:e,clientWidth:t}=document.body;T.x.max=t,T.y.max=e,await w(),h.value.drawImage(C,0,0)}));function b(e){O.value=!0;const{x:t,y:n}=e;Object.assign(I,{x:t,y:n}),P.value="CREATE",oe("*","cursor: crosshair !important;",u=ne()),x(e)}function x(e){l=y.cloneDeep(I),e.stopImmediatePropagation();const{x:t,y:n}=e;o=[t,n],i.value=[t,n],document.addEventListener("mousemove",E),document.addEventListener("mouseup",_),document.onselectstart=()=>!1}function E(e){if(!o||!P.value)return;const[t,n]=o,a=Math.min(Math.max(e.x,T.x.min),T.x.max),s=Math.min(Math.max(e.y,T.y.min),T.y.max),[r,u]=[a-t,s-n];i.value=[a,s];const[d]=A.slice(-1);switch(P.value){case"CREATE":const[e,o]=[Math.min(t,a),Math.min(n,s)],[i,m]=[Math.abs(r),Math.abs(u)],[p,v]=[Math.min(i,T.x.max-e),Math.min(m,T.y.max-o)];Object.assign(I,{x:e,y:o,w:p,h:v});break;case"MOVE":{const{x:e,y:t}=l,{h:n,w:o}=I;I.x=Math.min(Math.max(e+r,T.x.min),T.x.max-o),I.y=Math.min(Math.max(t+u,T.y.min),T.y.max-n);break}case"RESIZE":{const{h:e,y:t,w:n,x:o}=l;c.includes("top")?(I.y=Math.min(s,t+e),I.h=Math.abs(t-s+e)):c.includes("bottom")&&(I.y=Math.min(s,t),I.h=Math.abs(s-t)),c.includes("left")?(I.x=Math.min(a,o+n),I.w=Math.abs(o-a+n)):c.includes("right")&&(I.x=Math.min(a,o),I.w=Math.abs(a-o))}case"LINE":"LINE"===(null==d?void 0:d.id)&&(d.path[1]=[a,s],K(A,h.value,C));break;case"RECT":"RECT"===(null==d?void 0:d.id)&&(d.path[1]=[a,s],K(A,h.value,C));break;case"ARROW":"ARROW"===(null==d?void 0:d.id)&&(d.path[1]=[a,s],K(A,h.value,C));break;case"ELLIPSE":"ELLIPSE"===(null==d?void 0:d.id)&&(d.path[1]=[a,s],K(A,h.value,C))}}function _(){var e;o=null,document.onselectstart=null,null==(e=null==u?void 0:u.parentNode)||e.removeChild(u),document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",_),P.value=null}return p((()=>{Y(document.body,f),function(e,t,n){const o=function(a){n&&n.call(this,a),function(e,t,n){e&&t&&n&&e.removeEventListener(t,n,!1)}(e,t,o)};!function(e,t,n,o=!1){e&&t&&n&&e.addEventListener(t,n,o)}(e,t,o)}(n.value,"mousedown",b),document.body.appendChild(C)})),v((()=>{ee(document.body,f)})),{startCapture:b,onMousedownCaptureLayer:function(e){if(!P.value)return function(e){P.value||(P.value="MOVE",oe("*","cursor: move !important;",u=ne()),x(e))}(e);console.log("TODO UPDATE TOOL => ",P.value),A.push({id:P.value,path:[[e.x,e.y]]}),x(e)},startResize:function(e,{position:t,cursor:n}){P.value="RESIZE",c=t,oe("*",`cursor: ${n} !important;`,u=ne()),x(e)},captureLayerStyle:m,mousePoint:i,RESIZE_POINTS:ue,RGB:r,captureLayer:I,infoBoxVisible:d,bound:T,canvasRef:S,wrapRef:n}}});const me={class:"wrapper",ref:"wrapRef"};de.render=function(e,t){const n=E("InfoBox"),o=E("tool-box");return m(),i(f,null,[r("div",me,[r("canvas",{ref:"canvasRef",width:e.bound.x.max,height:e.bound.y.max},null,8,["width","height"]),r("div",{class:"capture-layer",style:e.captureLayerStyle,onMousedown:t[1]||(t[1]=(...t)=>e.onMousedownCaptureLayer&&e.onMousedownCaptureLayer(...t))},[(m(!0),i(f,null,b(e.RESIZE_POINTS,(t=>(m(),i("i",{onMousedown:M((n=>e.startResize(n,t)),["prevent"]),key:t.position.join(),style:t.position.reduce(((e,t)=>Object.assign(e,{[t]:"-3px"})),{cursor:t.cursor}),class:"resize-point"},null,44,["onMousedown"])))),128))],36),e.infoBoxVisible?(m(),i(n,{key:0,mousePoint:e.mousePoint,canvas:e.canvasRef},{default:_((()=>[r("p",null,x(e.captureLayer.w)+" x "+x(e.captureLayer.h),1),r("p",null,"RGB("+x(e.RGB)+")",1)])),_:1},8,["mousePoint","canvas"])):g("",!0)],512),r(o)],64)},function(e,t){if(!t)return e();if(void 0===L){const e=document.createElement("link").relList;L=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if(e in k)return;k[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":L,t||(o.as="script",o.crossOrigin=""),o.href=e,document.head.appendChild(o),t?new Promise(((e,t)=>{o.addEventListener("load",e),o.addEventListener("error",t)})):void 0}))).then((()=>e()))}((()=>__import__("./bigbadfox1080p.mkv_20201108_104416.220.8e277ed3.js")),void 0).then((e=>fetch(e.default))).then((e=>e.blob())).then((e=>{C.src=URL.createObjectURL(e),C.onload=()=>R(de).mount("#app")}));
