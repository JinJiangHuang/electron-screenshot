import{r as e,a as t,d as n,t as o,c as a,w as s,b as i,e as l,f as r,g as c,p as u,h as d,o as m,i as h,j as p,k as v,F as f,l as x,m as b,n as y,q as E,s as w,u as M,v as _,x as R,y as g}from"./vendor.1e27083b.js";let C;!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const o=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,s)=>{const i=new URL(e,o);if(self[t].moduleMap[i])return n(self[t].moduleMap[i]);const l=new Blob([`import * as m from '${i}';`,`${t}.moduleMap['${i}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(l),onerror(){s(new Error(`Failed to import: ${e}`)),a(r)},onload(){n(self[t].moduleMap[i]),a(r)}});document.head.appendChild(r)})),self[t].moduleMap={}}}("assets/");const L={},O=new Image,T=e(!1),k=t({x:{min:0,max:0},y:{min:0,max:0}}),I=t({x:-999,y:-999,h:0,w:0}),S=e(null),P=e(null),A=t([]),N=e(null);function z(e=A){if(0===e.length)return void(N.value=null);null!=N.value||(N.value={x:{min:0,max:0},y:{min:0,max:0}});const t=e.reduce(((e,{path:t})=>(t&&e.push(...t),e)),[]),[n,o]=t.reduce(((e,[t,n])=>(e[0].push(t),e[1].push(n),e)),[[],[]]);N.value.x.min=Math.min(...n),N.value.x.max=Math.max(...n),N.value.y.min=Math.min(...o),N.value.y.max=Math.max(...o),console.log(N.value)}function j(e){let t=!1;return function(...n){t||(t=!0,window.requestAnimationFrame((()=>{e.apply(this,n),t=!1})))}}const B=10,U=10,[D,$]=[120,88],[V,W]=[D/4,$/4];var H=n({props:{mousePoint:{type:Object,required:!0},canvas:{type:Object,required:!0}},setup(t){const{mousePoint:n,canvas:i}=o(t),l=e(null),r=a((()=>{const e={};if(n.value){const[t,o]=n.value,[a,s]=[B+120,U+120],i=t+a>k.x.max?t-a:t+B,l=o+s>k.y.max?o-s:o+U;e.left=`${i}px`,e.top=`${l}px`}return e}));return s(n,j((e=>{if(!e||!i.value||!l.value)return;const[t,n]=e,o=l.value.getContext("2d");o.clearRect(0,0,D,$),o.drawImage(i.value,t-V/2,n-W/2,V,W,0,0,D,$)}))),document.body.style,{canvasRef:l,DW:D,DH:$,style:r}}});const q=c("data-v-515d9b03");u("data-v-515d9b03");const F={class:"capture-info__view"},Z=l("svg",{viewBox:"0 0 120 88",xmlns:"http://www.w3.org/2000/svg",fill:"none"},[l("path",{d:"M 0 1 H 119 V87 H1 V1",stroke:"red","stroke-width":"2"}),l("path",{d:"M 0 44 H 119",stroke:"red","stroke-width":"2"}),l("path",{d:"M 60 0 V 88",stroke:"red","stroke-width":"2"})],-1),G={class:"capture-info__p"};d();const X=q(((e,t)=>(m(),i("div",{class:"capture-info__wrap",style:e.style},[l("div",F,[l("canvas",{ref:"canvasRef",width:e.DW,height:e.DH},null,8,["width","height"]),Z]),l("div",G,[r(e.$slots,"default")])],4))));H.render=X,H.__scopeId="data-v-515d9b03";const J=Math.PI/6;const K=e=>new Promise(((t,n)=>e.toBlob((e=>e?t(e):n(new Error("Failed to convert file"))))));function Q(e,t,n,o,a){const s=document.createElement("canvas");Object.assign(s,{height:a,width:o});return s.getContext("2d").drawImage(e,t,n,o,a,0,0,o,a),s}function Y(e,t=P.value.getContext("2d"),n=O){t.clearRect(0,0,k.x.max,k.y.max),t.drawImage(n,0,0),e.forEach((e=>{switch(e.id){case"LINE":{const[n,o]=e.path;!function(e,t,n,o,a){e.lineWidth=o,e.strokeStyle=a,e.lineCap="round",e.beginPath(),e.moveTo(...t),e.lineTo(...n),e.stroke()}(t,n,o,1,"red");break}case"RECT":{const[n,o]=e.path;!function(e,t,n,o,a){const[[s,i],[l,r]]=[t,n],c=[t,[s,r],n,[l,i]];e.beginPath(),e.moveTo(...t),c.slice(1).forEach((t=>e.lineTo(...t))),e.closePath(),e.lineWidth=o,e.strokeStyle=a,e.stroke()}(t,n,o,1,"red");break}case"ARROW":{const[n,o]=e.path;!function(e,t,n,o,a){const[s,i]=t,[l,r]=n,c=Math.atan((i-r)/(s-l)),u=Math.abs((l-s)/(Math.cos(c)*Math.cos(J))),d=Math.min(u,6+2*o),m=l<s?-1:1,[h,p]=[l-Math.cos(c-J)*d*m,r-Math.sin(c-J)*d*m],[v,f]=[l-Math.cos(c+J)*d*m,r-Math.sin(c+J)*d*m],[x,b]=[(v-h)/3,(f-p)/3],[y,E]=[h+x,p+b],[w,M]=[v-x,f-b],_=[[s,i],[y,E],[h,p],[l,r],[v,f],[w,M]];e.beginPath(),e.moveTo(s,i),_.slice(1).forEach((t=>e.lineTo(...t))),e.closePath(),e.fillStyle=a,e.fill()}(t,n,o,4,"red");break}case"ELLIPSE":{const[n,o]=e.path;!function(e,t,n,o,a){const[[s,i],[l,r]]=[t,n],[c,u]=[s-l,i-r].map((e=>Math.abs(e/2))),[d,m]=[(s+l)/2,(i+r)/2],h=Math.max(c,u),[p,v]=[c/h,u/h];e.save(),e.scale(p,v),e.beginPath(),e.arc(d/p,m/v,h,0,2*Math.PI),e.closePath(),e.restore(),e.lineWidth=o,e.strokeStyle=a,e.stroke()}(t,n,o,1,"red");break}case"BRUSH":!function(e,t,n,o){if(t.length<2)return;e.lineWidth=n,e.strokeStyle=o,e.lineCap="round",e.beginPath();let a=t[0];e.moveTo(...a);for(let s=1;s<t.length-1;s++){const[[n,o],[i,l]]=t.slice(s,s+2),[r,c]=[n+(i-n)/2,o+(l-o)/2];e.quadraticCurveTo(n,o,r,c),a=[r,c]}e.lineTo(...t.slice(-1)[0]),e.stroke(),e.closePath()}(t,e.path,4,"red")}}))}const ee=function(e){for(const t of e){const e=t.target.__resizeListeners__||[];e.length&&e.forEach((e=>{e()}))}},te=function(e,t){e&&(e.__resizeListeners__||(e.__resizeListeners__=[],e.__ro__=new h(ee),e.__ro__.observe(e)),e.__resizeListeners__.push(t))},ne=function(e,t){e&&e.__resizeListeners__&&(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),e.__resizeListeners__.length||e.__ro__.disconnect())};let oe=null;function ae(e=document.getElementsByTagName("head")[0]){const t=document.createElement("style");return t.media="screen",e.appendChild(t),t}function se(e,t,n=function(){return null!=oe?oe:oe=ae()}()){n&&t&&n.sheet.insertRule(e+"{"+t+"}",0)}const ie=0,le=6,re=[{icon:"A",label:"添加文字 TODO 😁",id:"TEXT"},{icon:"⬜",label:"矩形工具",id:"RECT"},{icon:"⚪",label:"椭圆工具",id:"ELLIPSE"},{icon:"╱",label:"直线工具",id:"LINE"},{icon:"↗",label:"箭头工具",id:"ARROW"},{icon:"🖊",label:"笔刷工具",id:"BRUSH"},{icon:"🐴",label:"马赛克工具 TODO 😁",id:"MOSAIC"}],ce=[{icon:"↩",label:"撤销",id:"RETURN"},{icon:"⬇",label:"保存(下载图片)",id:"SAVE"},{icon:"❌",label:"取消",id:"CANCEL"},{icon:"✔",label:"确定(复制到剪切板)",id:"CONFIRM"}];var ue=n({name:"ToolBox",emits:["dispatch"],setup(n,o){const s=e(null),i=t({w:0,h:0}),l=a((()=>{const e={};if(T.value&&"CREATE"!==S.value){const{x:t,y:n,w:o,h:a}=I,s=n+a+le+i.h+le>k.y.max?Math.max(n-i.h-le,k.y.min):n+a+le,l=Math.max(t+o-i.w-ie,k.x.min+ie);e.left=`${l}px`,e.top=`${s}px`}else e.visibility="hidden";return e})),r=j((function(){const{width:e,height:t}=s.value.getBoundingClientRect();Object.assign(i,{w:e,h:t})}));return p((()=>{te(s.value,r)})),v((()=>{ne(s.value,r)})),{TOOL_ACTIONS:re,OPT_ACTIONS:ce,style:l,action:S,handleExecCmd:function e(t){switch(t){case"SAVE":{const{x:e,y:t,w:n,h:o}=I;!function(e,t,n,o,a){const s=Q(e,t,n,o,a),i=s.toDataURL("image/png");K(s).then(console.log);const l=document.createElement("a");l.download=`导出图片${Date.now()}.png`,l.href=i,l.click()}(P.value,e,t,n,o);break}case"CONFIRM":{const{x:e,y:t,w:o,h:a}=I;(n=Q(P.value,e,t,o,a),navigator.permissions.query({name:"clipboard-write"}).then((async({state:e})=>{if("granted"!==e)throw new Error("clipboard-permissoin not granted");return K(n).then((e=>{const{type:t}=e;return navigator.clipboard.write([new ClipboardItem({[t]:e})])}))}))).then(console.log,console.warn);break}case"RETURN":if(0===A.length)break;A.pop(),Y(A),z();break;case"CANCEL":A.length=1,e("RETURN"),Object.assign(I,{x:-999,y:-999,h:0,w:0});break;default:return void console.log("TODO EXEC CMD => ",t)}var n;o.emit("dispatch",t)},handleUpdateTool:function(e){S.value=S.value===e?null:e},toolBoxRef:s}}});const de=l("div",{class:"tool-divider"},null,-1);ue.render=function(e,t){return m(),i("div",{ref:"toolBoxRef",class:"tool-box",style:e.style},[(m(!0),i(f,null,x(e.TOOL_ACTIONS,(t=>(m(),i("button",{key:t.id,class:["tool-item",e.action===t.id&&"active"],title:t.label,onClick:n=>e.handleUpdateTool(t.id)},b(t.icon),11,["title","onClick"])))),128)),de,(m(!0),i(f,null,x(e.OPT_ACTIONS,(t=>(m(),i("button",{key:t.id,class:"tool-item",title:t.label,onClick:n=>e.handleExecCmd(t.id)},b(t.icon),9,["title","onClick"])))),128))],4)};const me=Object.freeze(["CREATE","MOVE","RESIZE"]),he=Object.freeze(["TEXT","RECT","ELLIPSE","LINE","ARROW","BRUSH","MOSAIC"]);Object.freeze(["RETURN","SAVE","CANCEL","CONFIRM"]);const pe=[{position:["top"],cursor:"ns-resize"},{position:["bottom"],cursor:"ns-resize"},{position:["left"],cursor:"ew-resize"},{position:["right"],cursor:"ew-resize"},{position:["top","left"],cursor:"nwse-resize"},{position:["bottom","right"],cursor:"nwse-resize"},{position:["top","right"],cursor:"nesw-resize"},{position:["bottom","left"],cursor:"nesw-resize"}];var ve=n({name:"App",components:{InfoBox:H,ToolBox:ue},setup(){const t=e(null);let n=null;const o=e(null),i=e("0, 0, 0");let l=y.cloneDeep(I),r=[],c=null;const u=a((()=>S.value&&["CREATE","RESIZE"].includes(S.value))),d=a((()=>{const{x:e,y:t,h:n,w:o}=I,[a,s,i,l]=[e,t,n,o].map((e=>`${e}px`)),r={left:a,top:s,height:i,width:l,cursor:""};return S.value||(r.cursor="move"),r})),m=a((()=>{var e;return null==(e=P.value)?void 0:e.getContext("2d")}));s(o,j((e=>{if(!m.value||!e)return;const{data:t}=m.value.getImageData(e[0],e[1],1,1);i.value=t.slice(0,3).join(", ")})));const h=j((async function(){const{clientHeight:e,clientWidth:t}=document.body;k.x.max=t,k.y.max=e,await E(),Y(A,m.value,O)}));function f(e){T.value=!0;const{x:t,y:n}=e;Object.assign(I,{x:t,y:n}),S.value="CREATE",se("*","cursor: crosshair !important;",c=ae()),x(e)}function x(e){l=y.cloneDeep(I),e.stopImmediatePropagation();const{x:t,y:a}=e;n=[t,a],o.value=[t,a],document.addEventListener("mousemove",b),document.addEventListener("mouseup",w),document.onselectstart=()=>!1}function b(e){var t,a,s,i,c,u,d,h;if(!n||!S.value)return;const[p,v]=n;let f=Math.min(Math.max(e.x,k.x.min),k.x.max),x=Math.min(Math.max(e.y,k.y.min),k.y.max);const[b,E]=[f-p,x-v];o.value=[f,x];const[w]=A.slice(-1);if(me.includes(S.value))switch(S.value){case"CREATE":const[e,n]=[Math.min(p,f),Math.min(v,x)],[o,m]=[Math.abs(b),Math.abs(E)],[y,w]=[Math.min(o,k.x.max-e),Math.min(m,k.y.max-n)];Object.assign(I,{x:e,y:n,w:y,h:w});break;case"MOVE":{const{x:e,y:n}=l,{h:o,w:r}=I,c=N.value;I.x=Math.min(Math.max(e+b,k.x.min,(null!=(t=null==c?void 0:c.x.max)?t:-1/0)-r),k.x.max-r,null!=(a=null==c?void 0:c.x.min)?a:1/0),I.y=Math.min(Math.max(n+E,k.y.min,(null!=(s=null==c?void 0:c.y.max)?s:-1/0)-o),k.y.max-o,null!=(i=null==c?void 0:c.y.min)?i:1/0);break}case"RESIZE":{const{h:e,y:t,w:n,x:o}=l,a=N.value;r.includes("top")?(x=Math.min(x,null!=(c=null==a?void 0:a.y.min)?c:1/0),I.y=Math.min(x,t+e),I.h=Math.abs(t-x+e)):r.includes("bottom")&&(x=Math.max(x,null!=(u=null==a?void 0:a.y.max)?u:-1/0),I.y=Math.min(x,t),I.h=Math.abs(x-t)),r.includes("left")?(f=Math.min(f,null!=(d=null==a?void 0:a.x.min)?d:1/0),I.x=Math.min(f,o+n),I.w=Math.abs(o-f+n)):r.includes("right")&&(f=Math.max(f,null!=(h=null==a?void 0:a.x.max)?h:-1/0),I.x=Math.min(f,o),I.w=Math.abs(f-o));break}}else if(he.includes(S.value)){if((null==w?void 0:w.id)!==S.value)return;const e=function([e,t]){const{x:n,y:o,w:a,h:s}=I;return[Math.max(Math.min(e,n+a),n),Math.max(Math.min(t,o+s),o)]}([f,x]),[t]=w.path.slice(-1);if(y.isEqual(e,t))return;switch(S.value){case"LINE":case"RECT":case"ARROW":case"ELLIPSE":w.path[1]=e;break;case"BRUSH":w.path.push(e);break;default:return}Y(A,m.value,O)}}function w(){var e;n=null,document.onselectstart=null,null==(e=null==c?void 0:c.parentNode)||e.removeChild(c),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",w),me.includes(S.value)&&(S.value=null),z()}function M(){T.value=!1,function(e,t,n){const o=function(a){n&&n.call(this,a),function(e,t,n){e&&t&&n&&e.removeEventListener(t,n,!1)}(e,t,o)};!function(e,t,n,o=!1){e&&t&&n&&e.addEventListener(t,n,o)}(e,t,o)}(t.value,"mousedown",f)}return p((()=>{te(document.body,h),M()})),v((()=>{ne(document.body,h)})),{startCapture:f,onMousedownCaptureLayer:function(e){S.value?he.includes(S.value)&&(A.push({id:S.value,path:[[e.x,e.y]]}),x(e)):function(e){S.value||(S.value="MOVE",se("*","cursor: move !important;",c=ae()),x(e))}(e)},startResize:function(e,{position:t,cursor:n}){S.value="RESIZE",r=t,se("*",`cursor: ${n} !important;`,c=ae()),x(e)},handleToolCmd:function(e){switch(e){case"CANCEL":M()}},captureLayerStyle:d,mousePoint:o,RESIZE_POINTS:pe,RGB:i,captureLayer:I,infoBoxVisible:u,bound:k,canvasRef:P,wrapRef:t}}});const fe={ref:"wrapRef",class:"wrapper"};ve.render=function(e,t){const n=w("info-box"),o=w("tool-box");return m(),i(f,null,[l("div",fe,[l("canvas",{ref:"canvasRef",width:e.bound.x.max,height:e.bound.y.max},null,8,["width","height"]),l("div",{class:"capture-layer",style:e.captureLayerStyle,onMousedown:t[1]||(t[1]=(...t)=>e.onMousedownCaptureLayer&&e.onMousedownCaptureLayer(...t))},[(m(!0),i(f,null,x(e.RESIZE_POINTS,(t=>(m(),i("i",{key:t.position.join(),style:t.position.reduce(((e,t)=>Object.assign(e,{[t]:"-3px"})),{cursor:t.cursor}),class:"resize-point",onMousedown:R((n=>e.startResize(n,t)),["prevent"])},null,44,["onMousedown"])))),128))],36),e.infoBoxVisible?(m(),i(n,{key:0,"mouse-point":e.mousePoint,canvas:e.canvasRef},{default:M((()=>[l("p",null,b(e.captureLayer.w)+" x "+b(e.captureLayer.h),1),l("p",null,"RGB("+b(e.RGB)+")",1)])),_:1},8,["mouse-point","canvas"])):_("",!0)],512),l(o,{onDispatch:e.handleToolCmd},null,8,["onDispatch"])],64)},function(e,t){if(!t)return e();if(void 0===C){const e=document.createElement("link").relList;C=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if(e in L)return;L[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":C,t||(o.as="script",o.crossOrigin=""),o.href=e,document.head.appendChild(o),t?new Promise(((e,t)=>{o.addEventListener("load",e),o.addEventListener("error",t)})):void 0}))).then((()=>e()))}((()=>__import__("./bigbadfox1080p.mkv_20201108_104416.220.8e277ed3.js")),void 0).then((e=>fetch(e.default))).then((e=>e.blob())).then((e=>{O.src=URL.createObjectURL(e),O.onload=()=>g(ve).mount("#app")}));
