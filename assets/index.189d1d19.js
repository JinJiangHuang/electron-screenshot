import{r as e,a as t,s as n,d as o,t as a,c as i,w as r,b as s,e as l,f as c,g as u,p as d,h,o as m,i as p,j as f,k as v,F as b,l as w,m as y,n as x,q as E,u as _,v as g,x as M,y as R,z as O,A as L}from"./vendor.32e97aa7.js";let C;!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const o=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,i)=>{const r=new URL(e,o);if(self[t].moduleMap[r])return n(self[t].moduleMap[r]);const s=new Blob([`import * as m from '${r}';`,`${t}.moduleMap['${r}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){i(new Error(`Failed to import: ${e}`)),a(l)},onload(){n(self[t].moduleMap[r]),a(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("assets/");const T={},k=function(e,t){if(!t)return e();if(void 0===C){const e=document.createElement("link").relList;C=e&&e.supports&&e.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(t.map((e=>{if(e in T)return;T[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":C,t||(o.as="script",o.crossOrigin=""),o.href=e,document.head.appendChild(o),t?new Promise(((e,t)=>{o.addEventListener("load",e),o.addEventListener("error",t)})):void 0}))).then((()=>e()))},I=Object.freeze(["CREATE","MOVE","RESIZE"]),S=Object.freeze(["TEXT","RECT","ELLIPSE","LINE","ARROW","BRUSH","MOSAIC"]);Object.freeze(["RETURN","SAVE","CANCEL","CONFIRM"]);const j="#ff0000",A=2,P=new Image,U=e(!1),D=t({x:{min:0,max:0},y:{min:0,max:0}}),N=t({x:-999,y:-999,h:0,w:0}),B=e(null),z=e(null),$=n([]),V=e(null);function W(e=$){if(0===e.length)return void(V.value=null);null!=V.value||(V.value={x:{min:0,max:0},y:{min:0,max:0}});const t=e.reduce(((e,{path:t})=>(t&&e.push(...t),e)),[]),[n,o]=t.reduce(((e,[t,n])=>(e[0].push(t),e[1].push(n),e)),[[],[]]);V.value.x.min=Math.min(...n),V.value.x.max=Math.max(...n),V.value.y.min=Math.min(...o),V.value.y.max=Math.max(...o),console.log(V.value)}const F=e(null),H=[{icon:"A",label:"添加文字(TODO)",id:"TEXT",cursor:"text"},{icon:"⬜",label:"矩形工具",id:"RECT",attr:t({color:j,width:A})},{icon:"⚪",label:"椭圆工具",id:"ELLIPSE",attr:t({color:j,width:A})},{icon:"╱",label:"直线工具",id:"LINE",attr:t({color:j,width:A})},{icon:"↗",label:"箭头工具",id:"ARROW",attr:t({color:j,width:A})},{icon:"🖊",label:"笔刷工具",id:"BRUSH",attr:t({color:j,width:A})},{icon:"🐴",label:"马赛克工具",id:"MOSAIC"}],q=Math.PI/6;function Z(e,t=10){const{width:n,height:o}=e.canvas,[a,i]=[Math.ceil(n/t),Math.ceil(o/t)],r=e.getImageData(0,0,n,o).data,s=new Uint8ClampedArray(a*i*4);for(let l=0;l<a*i;l++){const e=Math.floor(l/a),i=l-e*a;let[c,u,d,h]=[0,0,0,0];for(let a=e*t;a<Math.min((e+1)*t,o);a++){const e=a*n;for(let o=i*t;o<Math.min((i+1)*t,n);o++){const t=4*(e+o);c+=r[t],u+=r[t+1],d+=r[t+2],h++}}[s[4*l],s[4*l+1],s[4*l+2],s[4*l+3]]=[c/h,u/h,d/h,255]}return s}function G(e,t,n=10,o=30,a){const{height:i,width:r}=e.canvas,s=((e,t,n,o)=>n.reduce(((n,[a,i])=>{const[r,s]=[Math.max(0,a-o),Math.min(a+o,e)],[l,c]=[Math.max(0,i-o),Math.min(i+o,t)];for(let t=l;t<c;t++)for(let l=r;l<s;l++)(l-a)**2+(t-i)**2<o**2&&(n[t*e+l]=!0);return n}),Array(e*t).fill(!1)))(r,i,t,o/2),[l,c]=[Math.ceil(r/n),Math.ceil(i/n)],u=e.getImageData(0,0,r,i).data,d=new Uint8ClampedArray(r*i*4);null!=a||(a=Z(e,n));for(let h=0;h<c;h++){const[e,t]=[h*n,Math.min((h+1)*n,i)];for(let o=0;o<l;o++){const[i,c]=[o*n,Math.min((o+1)*n,r)],m=4*(h*l+o),[p,f,v,b]=[a[m],a[m+1],a[m+2],255];for(let n=e;n<t;n++)for(let e=i;e<c;e++){const t=n*r+e,o=4*t;s[t]?(d[o]=p,d[o+1]=f,d[o+2]=v,d[o+3]=b):(d[o]=u[o],d[o+1]=u[o+1],d[o+2]=u[o+2],d[o+3]=u[o+3])}}}e.putImageData(new ImageData(d,r,i),0,0)}const X=e=>new Promise(((t,n)=>e.toBlob((e=>e?t(e):n(new Error("Failed to convert file"))))));function J(e,t,n,o,a){const i=document.createElement("canvas");Object.assign(i,{height:a,width:o});return i.getContext("2d").drawImage(e,t,n,o,a,0,0,o,a),i}function K(e,t=z.value.getContext("2d"),n=P){t.clearRect(0,0,D.x.max,D.y.max),t.drawImage(n,0,0),e.forEach((e=>{var n;const{width:o=A,color:a=j}=null!=(n=e.attr)?n:{};switch(e.id){case"LINE":{const[n,i]=e.path;!function(e,t,n,o,a){e.lineWidth=o,e.strokeStyle=a,e.lineCap="round",e.beginPath(),e.moveTo(...t),e.lineTo(...n),e.stroke()}(t,n,i,o,a);break}case"RECT":{const[n,i]=e.path;!function(e,t,n,o,a){const[[i,r],[s,l]]=[t,n],c=[t,[i,l],n,[s,r]];e.beginPath(),e.moveTo(...t),c.slice(1).forEach((t=>e.lineTo(...t))),e.closePath(),e.lineWidth=o,e.strokeStyle=a,e.stroke()}(t,n,i,o,a);break}case"ARROW":{const[n,i]=e.path;!function(e,t,n,o,a){const[i,r]=t,[s,l]=n,c=Math.atan((r-l)/(i-s)),u=Math.abs((s-i)/(Math.cos(c)*Math.cos(q))),d=Math.min(u,6+2*o),h=s<i?-1:1,[m,p]=[s-Math.cos(c-q)*d*h,l-Math.sin(c-q)*d*h],[f,v]=[s-Math.cos(c+q)*d*h,l-Math.sin(c+q)*d*h],[b,w]=[(f-m)/3,(v-p)/3],[y,x]=[m+b,p+w],[E,_]=[f-b,v-w],g=[[i,r],[y,x],[m,p],[s,l],[f,v],[E,_]];e.beginPath(),e.moveTo(i,r),g.slice(1).forEach((t=>e.lineTo(...t))),e.closePath(),e.fillStyle=a,e.fill()}(t,n,i,o,a);break}case"ELLIPSE":{const[n,i]=e.path;!function(e,t,n,o,a){const[[i,r],[s,l]]=[t,n],[c,u]=[i-s,r-l].map((e=>Math.abs(e/2))),[d,h]=[(i+s)/2,(r+l)/2],m=Math.max(c,u),[p,f]=[c/m,u/m];e.save(),e.scale(p,f),e.beginPath(),e.arc(d/p,h/f,m,0,2*Math.PI),e.closePath(),e.restore(),e.lineWidth=o,e.strokeStyle=a,e.stroke()}(t,n,i,o,a);break}case"BRUSH":!function(e,t,n,o){if(t.length<2)return;e.lineWidth=n,e.strokeStyle=o,e.lineCap="round",e.beginPath();let a=t[0];e.moveTo(...a);for(let i=1;i<t.length-1;i++){const[[n,o],[r,s]]=t.slice(i,i+2),[l,c]=[n+(r-n)/2,o+(s-o)/2];e.quadraticCurveTo(n,o,l,c),a=[l,c]}e.lineTo(...t.slice(-1)[0]),e.stroke(),e.closePath()}(t,e.path,o,a);break;case"MOSAIC":G(t,e.path,10,30,F.value)}}))}function Q(e){let t=!1;return function(...n){t||(t=!0,window.requestAnimationFrame((()=>{e.apply(this,n),t=!1})))}}async function Y(e,t=document.title){var n,o;if(!("Notification"in window))throw new Error("This browser does not support notification");if("granted"===Notification.permission)return e.icon||(e.icon=null!=(o=null==(n=document.querySelector("link[rel*=icon]"))?void 0:n.getAttribute("href"))?o:void 0),new Notification(t,e);if("denied"===Notification.permission)throw new Error("notification permission denied");return await Notification.requestPermission(),await Y(e,t)}const ee=()=>navigator.mediaDevices.getDisplayMedia().then((e=>new Promise(((t,n)=>{const o=document.createElement("video");o.setAttribute("autoplay","true"),((e=0)=>new Promise((t=>setTimeout(t,e))))(1e3).then(n),o.onplay=()=>t(o),o.srcObject=e})))).then((e=>{var t;const{videoHeight:n,videoWidth:o}=e,a=document.createElement("canvas");Object.assign(a,{height:n,width:o}),null==(t=a.getContext("2d"))||t.drawImage(e,0,0);return e.srcObject.getTracks().forEach((e=>e.stop())),e.srcObject=null,X(a)})),te=10,ne=10,[oe,ae]=[120,88],[ie,re]=[oe/4,ae/4];var se=o({props:{mousePoint:{type:Object,required:!0},canvas:{type:Object,required:!0}},setup(t){const{mousePoint:n,canvas:o}=a(t),s=e(null),l=i((()=>{const e={};if(n.value){const[t,o]=n.value,[a,i]=[te+120,ne+120],r=t+a>D.x.max?t-a:t+te,s=o+i>D.y.max?o-i:o+ne;e.left=`${r}px`,e.top=`${s}px`}return e}));return r(n,Q((e=>{if(!e||!o.value||!s.value)return;const[t,n]=e,a=s.value.getContext("2d");a.clearRect(0,0,oe,ae),a.drawImage(o.value,t-ie/2,n-re/2,ie,re,0,0,oe,ae)}))),document.body.style,{canvasRef:s,DW:oe,DH:ae,style:l}}});const le=u("data-v-515d9b03");d("data-v-515d9b03");const ce={class:"capture-info__view"},ue=l("svg",{viewBox:"0 0 120 88",xmlns:"http://www.w3.org/2000/svg",fill:"none"},[l("path",{d:"M 0 1 H 119 V87 H1 V1",stroke:"red","stroke-width":"2"}),l("path",{d:"M 0 44 H 119",stroke:"red","stroke-width":"2"}),l("path",{d:"M 60 0 V 88",stroke:"red","stroke-width":"2"})],-1),de={class:"capture-info__p"};h();const he=le(((e,t)=>(m(),s("div",{class:"capture-info__wrap",style:e.style},[l("div",ce,[l("canvas",{ref:"canvasRef",width:e.DW,height:e.DH},null,8,["width","height"]),ue]),l("div",de,[c(e.$slots,"default")])],4))));se.render=he,se.__scopeId="data-v-515d9b03";function me(e,t=100,n=100,o){const[a,i,r]=function(e,t,n){return function(e,t,n){e=6*pe(e,360),t=pe(t,100),n=pe(n,100);const o=Math.floor(e),a=e-o,i=n*(1-t),r=n*(1-a*t),s=n*(1-(1-a)*t),l=o%6,c=[n,r,i,i,s,n][l],u=[s,n,n,r,i,i][l],d=[i,i,s,n,n,r][l];return[Math.round(255*c),Math.round(255*u),Math.round(255*d)]}(e,t,n).map((e=>Math.min(Math.round(e),255).toString(16).padStart(2,"0")))}(e,t,n);return`#${a}${i}${r}${o?Math.round(255*o/100).toString(16).padStart(2,"0"):""}`}const pe=function(e,t){var n;"string"==typeof(n=e)&&-1!==n.indexOf(".")&&1===parseFloat(n)&&(e="100%");const o=(e=>"string"==typeof e&&-1!==e.indexOf("%"))(e);return e=Math.min(t,Math.max(0,parseFloat(e+""))),o&&(e=parseInt(e*t+"",10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)};const fe=["#000000",...[...Array(18)].map(((e,t)=>me(20*t))),"#ffffff"],ve=[2,4,6];var be=o({name:"StyleBox",props:{reference:{type:Object,required:!0},visibility:{type:Boolean,default:!0},color:{type:String},width:{type:Number}},emits:["update:color","update:width"],setup(t){const{visibility:n,reference:o}=a(t),i=e(null);let s=null;function l(){n.value&&(s=v(o.value,i.value,{placement:"bottom-start",modifiers:[{name:"offset",options:{offset:[0,4]}}]}),s.update())}return r(n,l),p((()=>{l()})),f((()=>{null==s||s.destroy()})),{COLORS:fe,WIDTHS:ve,popperRef:i}}});const we={ref:"popperRef",class:"style-box"},ye={key:1,class:"color-box"};be.render=function(e,t){return m(),s("div",we,[e.width?(m(!0),s(b,{key:0},w(e.WIDTHS,(t=>(m(),s("button",{key:t,class:["width__button",t===e.width&&"active"],style:`--size-width-height: ${t}px;`,onClick:n=>e.$emit("update:width",t)},null,14,["onClick"])))),128)):y("",!0),e.color?(m(),s("div",ye,[l("button",{class:"select-color",style:{backgroundColor:e.color},title:e.color},null,12,["title"]),(m(!0),s(b,null,w(e.COLORS,(t=>(m(),s("button",{key:t,title:t,class:"color__button",style:{backgroundColor:t},"data-color":t,onClick:n=>e.$emit("update:color",t)},null,12,["title","data-color","onClick"])))),128))])):y("",!0)],512)};const xe=function(e){for(const t of e){const e=t.target.__resizeListeners__||[];e.length&&e.forEach((e=>{e()}))}},Ee=function(e,t){e&&(e.__resizeListeners__||(e.__resizeListeners__=[],e.__ro__=new x(xe),e.__ro__.observe(e)),e.__resizeListeners__.push(t))},_e=function(e,t){e&&e.__resizeListeners__&&(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),e.__resizeListeners__.length||e.__ro__.disconnect())};let ge=null;function Me(e=document.getElementsByTagName("head")[0]){const t=document.createElement("style");return t.media="screen",e.appendChild(t),t}function Re(e,t,n=function(){return null!=ge?ge:ge=Me()}()){n&&t&&n.sheet.insertRule(e+"{"+t+"}",0)}const Oe=(e,t=new Image)=>new Promise(((n,o)=>{t.onload=()=>n(t),t.onerror=e=>o(e),t.src=e})),Le=(e=new Image)=>((e="image/png")=>new Promise(((t,n)=>{const o=document.createElement("input");Object.assign(o,{accept:e,type:"file"}),o.onchange=()=>{var e;const a=null==(e=o.files)?void 0:e[0];(null==a?void 0:a.type.startsWith("image/"))?t(a):n()},o.click()})))().then((t=>Oe(URL.createObjectURL(t),e))),Ce=0,Te=6,ke=[{icon:"↩",label:"撤销",id:"RETURN"},{icon:"⚡",label:"更换底图(使用本地文件)",id:"USE_UPLOAD_FILE"},{icon:"✂",label:"更换底图(使用屏幕快照)",id:"USE_SCREEN_CAPTURE"},{icon:"⬇",label:"保存(下载图片)",id:"SAVE"},{icon:"❌",label:"取消",id:"CANCEL"},{icon:"✔",label:"确定(复制到剪切板)",id:"CONFIRM"}];var Ie=o({name:"ToolBox",components:{StyleBox:be},emits:["dispatch"],setup(n,o){const a=e(null),r=t({w:0,h:0}),s=i((()=>{const e={};if(U.value&&"CREATE"!==B.value){const{x:t,y:n,w:o,h:a}=N,i=n+a+Te+r.h+Te>D.y.max?Math.max(n-r.h-Te,D.y.min):n+a+Te,s=Math.max(t+o-r.w-Ce,D.x.min+Ce);e.left=`${s}px`,e.top=`${i}px`}else e.visibility="hidden";return e})),l=i((()=>H.find((({id:e})=>e===B.value)))),c=i((()=>{var e;return null==(e=l.value)?void 0:e.attr})),u=Q((function(){const{width:e,height:t}=a.value.getBoundingClientRect();Object.assign(r,{w:e,h:t})}));return p((()=>{Ee(a.value,u)})),f((()=>{_e(a.value,u)})),{TOOL_ACTIONS:H,OPT_ACTIONS:ke,style:s,action:B,styleBoxVisibility:c,currentTool:l,handleExecCmd:function e(t){switch(t){case"SAVE":{const{x:e,y:t,w:n,h:o}=N;!function(e,t,n,o,a){const i=J(e,t,n,o,a),r=i.toDataURL("image/png");X(i).then(console.log);const s=document.createElement("a");s.download=`导出图片${Date.now()}.png`,s.href=r,s.click()}(z.value,e,t,n,o);break}case"CONFIRM":{const{x:e,y:t,w:o,h:a}=N;(n=J(z.value,e,t,o,a),navigator.permissions.query({name:"clipboard-write"}).then((async({state:e})=>{if("granted"!==e)throw new Error("clipboard-permissoin not granted");return X(n).then((e=>{const{type:t}=e;return navigator.clipboard.write([new ClipboardItem({[t]:e})])}))}))).then((()=>{Y({body:"图片已复制"},"提示")}),(e=>{var t;Y({body:null!=(t=null==e?void 0:e.message)?t:"图片复制失败"},"提示")}));break}case"RETURN":if(0===$.length)break;$.pop(),K($),W();break;case"CANCEL":$.length=1,e("RETURN"),Object.assign(N,{x:-999,y:-999,h:0,w:0});break;case"USE_UPLOAD_FILE":{const e=P.src;Le(P).then((()=>{$.length=0,K($),URL.revokeObjectURL(e)}));break}case"USE_SCREEN_CAPTURE":{const e=P.src;((e=new Image)=>ee().then((t=>Oe(URL.createObjectURL(t),e))))(P).then((()=>{$.length=0,K($),URL.revokeObjectURL(e)}));break}default:return void console.log("TODO EXEC CMD => ",t)}var n;o.emit("dispatch",t)},handleUpdateTool:function(e){B.value=B.value===e?null:e},toolBoxRef:a}}});const Se=l("div",{class:"tool-divider"},null,-1);Ie.render=function(e,t){var n;const o=E("StyleBox");return m(),s(b,null,[l("div",{ref:"toolBoxRef",class:"tool-box",style:e.style},[(m(!0),s(b,null,w(e.TOOL_ACTIONS,(t=>(m(),s("button",{key:t.id,class:["tool-item",e.action===t.id&&"active"],title:t.label,onClick:n=>e.handleUpdateTool(t.id)},_(t.icon),11,["title","onClick"])))),128)),Se,(m(!0),s(b,null,w(e.OPT_ACTIONS,(t=>(m(),s("button",{key:t.id,class:"tool-item",title:t.label,onClick:n=>e.handleExecCmd(t.id)},_(t.icon),9,["title","onClick"])))),128))],4),(null==(n=e.currentTool)?void 0:n.attr)?(m(),s(o,{key:0,color:e.currentTool.attr.color,"onUpdate:color":t[1]||(t[1]=t=>e.currentTool.attr.color=t),width:e.currentTool.attr.width,"onUpdate:width":t[2]||(t[2]=t=>e.currentTool.attr.width=t),reference:e.toolBoxRef},null,8,["color","width","reference"])):y("",!0)],64)};const je=[{position:["top"],cursor:"ns-resize"},{position:["bottom"],cursor:"ns-resize"},{position:["left"],cursor:"ew-resize"},{position:["right"],cursor:"ew-resize"},{position:["top","left"],cursor:"nwse-resize"},{position:["bottom","right"],cursor:"nwse-resize"},{position:["top","right"],cursor:"nesw-resize"},{position:["bottom","left"],cursor:"nesw-resize"}];var Ae=o({name:"App",components:{InfoBox:se,ToolBox:Ie},setup(){const t=e(null);let n=null;const o=e(null),a=e("0, 0, 0");let s=g.cloneDeep(N),l=[],c=null;const u=i((()=>B.value&&["CREATE","RESIZE"].includes(B.value))),d=i((()=>{const{x:e,y:t,h:n,w:o}=N,[a,i,r,s]=[e,t,n,o].map((e=>`${e}px`)),l={left:a,top:i,height:r,width:s,cursor:""};return B.value||(l.cursor="move"),l})),h=i((()=>{var e;return null==(e=z.value)?void 0:e.getContext("2d")}));r(o,Q((e=>{if(!h.value||!e)return;const{data:t}=h.value.getImageData(e[0],e[1],1,1);a.value=t.slice(0,3).join(", ")})));const m=Q((async function(){const{clientHeight:e,clientWidth:t}=document.body;D.x.max=t,D.y.max=e,await M(),K($,h.value,P)}));function v(e){if(0!==e.button)return x();U.value=!0;const{x:t,y:n}=e;Object.assign(N,{x:t,y:n}),B.value="CREATE",Re("*","cursor: crosshair !important;",c=Me()),w(e)}const b=Q((function(e){var t,a,i,r,c,u,d,m;if(!n||!B.value)return;const[p,f]=n;let v=Math.min(Math.max(e.x,D.x.min),D.x.max),b=Math.min(Math.max(e.y,D.y.min),D.y.max);const[w,y]=[v-p,b-f];o.value=[v,b];const[x]=$.slice(-1);if(I.includes(B.value))switch(B.value){case"CREATE":const[e,n]=[Math.min(p,v),Math.min(f,b)],[o,h]=[Math.abs(w),Math.abs(y)],[x,E]=[Math.min(o,D.x.max-e),Math.min(h,D.y.max-n)];Object.assign(N,{x:e,y:n,w:x,h:E});break;case"MOVE":{const{x:e,y:n}=s,{h:o,w:l}=N,c=V.value;N.x=Math.min(Math.max(e+w,D.x.min,(null!=(t=null==c?void 0:c.x.max)?t:-1/0)-l),D.x.max-l,null!=(a=null==c?void 0:c.x.min)?a:1/0),N.y=Math.min(Math.max(n+y,D.y.min,(null!=(i=null==c?void 0:c.y.max)?i:-1/0)-o),D.y.max-o,null!=(r=null==c?void 0:c.y.min)?r:1/0);break}case"RESIZE":{const{h:e,y:t,w:n,x:o}=s,a=V.value;l.includes("top")?(b=Math.min(b,null!=(c=null==a?void 0:a.y.min)?c:1/0),N.y=Math.min(b,t+e),N.h=Math.abs(t-b+e)):l.includes("bottom")&&(b=Math.max(b,null!=(u=null==a?void 0:a.y.max)?u:-1/0),N.y=Math.min(b,t),N.h=Math.abs(b-t)),l.includes("left")?(v=Math.min(v,null!=(d=null==a?void 0:a.x.min)?d:1/0),N.x=Math.min(v,o+n),N.w=Math.abs(o-v+n)):l.includes("right")&&(v=Math.max(v,null!=(m=null==a?void 0:a.x.max)?m:-1/0),N.x=Math.min(v,o),N.w=Math.abs(v-o));break}}else if(S.includes(B.value)){if((null==x?void 0:x.id)!==B.value)return;const e=function([e,t]){const{x:n,y:o,w:a,h:i}=N;return[Math.max(Math.min(e,n+a),n),Math.max(Math.min(t,o+i),o)]}([v,b]),[t]=x.path.slice(-1);if(g.isEqual(e,t))return;switch(B.value){case"LINE":case"RECT":case"ARROW":case"ELLIPSE":x.path[1]=e;break;case"BRUSH":case"MOSAIC":x.path.push(e);break;default:return}K($,h.value,P)}}));function w(e){s=g.cloneDeep(N),e.stopImmediatePropagation();const{x:t,y:a}=e;n=[t,a],o.value=[t,a],document.addEventListener("mousemove",b),document.addEventListener("mouseup",y),document.onselectstart=()=>!1}function y(){var e;n=null,document.onselectstart=null,null==(e=null==c?void 0:c.parentNode)||e.removeChild(c),document.removeEventListener("mousemove",b),document.removeEventListener("mouseup",y),"MOSAIC"===B.value&&(F.value=null),I.includes(B.value)&&(B.value=null),W()}function x(){U.value=!1,function(e,t,n){const o=function(t){n&&n.call(this,t),function(e,t,n,o){e&&t&&n&&e.removeEventListener(t,n,null!=o&&o)}(e,t,o)};!function(e,t,n,o){e&&t&&n&&e.addEventListener(t,n,null!=o&&o)}(e,t,o)}(t.value,"mousedown",v)}return p((()=>{Ee(document.body,m),x()})),f((()=>{_e(document.body,m)})),{startCapture:v,onMousedownCaptureLayer:function(e){var t,n;if(B.value){if(S.includes(B.value)){const o={id:B.value,path:[[e.x,e.y]]},a=null==(n=B.value,t=H.find((e=>e.id===n)))?void 0:t.attr;a&&Object.assign(o,{attr:g.cloneDeep(a)}),$.push(o),"MOSAIC"===B.value&&(F.value=Z(h.value,10)),w(e)}}else!function(e){B.value||(B.value="MOVE",Re("*","cursor: move !important;",c=Me()),w(e))}(e)},startResize:function(e,{position:t,cursor:n}){B.value="RESIZE",l=t,Re("*",`cursor: ${n} !important;`,c=Me()),w(e)},handleToolCmd:function(e){switch(e){case"CANCEL":x()}},captureLayerStyle:d,mousePoint:o,RESIZE_POINTS:je,RGB:a,captureLayer:N,infoBoxVisible:u,bound:D,canvasRef:z,wrapRef:t}}});const Pe={ref:"wrapRef",class:"wrapper"};Ae.render=function(e,t){const n=E("info-box"),o=E("tool-box");return m(),s(b,null,[l("div",Pe,[l("canvas",{ref:"canvasRef",width:e.bound.x.max,height:e.bound.y.max},null,8,["width","height"]),l("div",{class:"capture-layer",style:e.captureLayerStyle,onMousedown:t[1]||(t[1]=R(((...t)=>e.onMousedownCaptureLayer&&e.onMousedownCaptureLayer(...t)),["left"]))},[(m(!0),s(b,null,w(e.RESIZE_POINTS,(t=>(m(),s("button",{key:t.position.join(),style:t.position.reduce(((e,t)=>Object.assign(e,{[t]:"-3px"})),{cursor:t.cursor}),class:"resize-point",onMousedown:R((n=>e.startResize(n,t)),["left","prevent"])},null,44,["onMousedown"])))),128))],36),e.infoBoxVisible?(m(),s(n,{key:0,"mouse-point":e.mousePoint,canvas:e.canvasRef},{default:O((()=>[l("p",null,_(e.captureLayer.w)+" x "+_(e.captureLayer.h),1),l("p",null,"RGB("+_(e.RGB)+")",1)])),_:1},8,["mouse-point","canvas"])):y("",!0)],512),l(o,{onDispatch:e.handleToolCmd},null,8,["onDispatch"])],64)};{null!=window._hmt||(window._hmt=[]);const e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?4e02e53abd8605530e0c10481dabdca0";const t=document.querySelector("script");t.parentNode.insertBefore(e,t)}Promise.all(g.range(0,8).map((e=>function(e){switch(e){case"./assets/0.jpg":return k((()=>__import__("./0.0f566388.js")),void 0);case"./assets/1.jpg":return k((()=>__import__("./1.9a9df9d9.js")),void 0);case"./assets/2.jpg":return k((()=>__import__("./2.3820c810.js")),void 0);case"./assets/3.jpg":return k((()=>__import__("./3.6adf29f6.js")),void 0);case"./assets/4.jpg":return k((()=>__import__("./4.5e23b482.js")),void 0);case"./assets/5.jpg":return k((()=>__import__("./5.7e2f0bda.js")),void 0);case"./assets/6.jpg":return k((()=>__import__("./6.20f56a99.js")),void 0);case"./assets/7.jpg":return k((()=>__import__("./7.28cf4bbf.js")),void 0);default:return Promise.reject(new Error("Unknown variable dynamic import: "+e))}}(`./assets/${e}.jpg`).then((e=>e.default))))).then((e=>fetch(e[g.random(7)]))).then((e=>e.blob())).then((e=>Oe(URL.createObjectURL(e),P))).then((()=>L(Ae).mount("#app")));
